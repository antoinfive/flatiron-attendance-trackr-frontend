'use strict';

require('es6-symbol/implement');

var _es6Map = require('es6-map');

var _es6Map2 = _interopRequireDefault(_es6Map);

var _es6Set = require('es6-set');

var _es6Set2 = _interopRequireDefault(_es6Set);

var _resolve = require('../core/resolve');

var _resolve2 = _interopRequireDefault(_resolve);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = function (context) {
  var imported = new _es6Map2.default();
  return {
    'ImportDeclaration': function ImportDeclaration(n) {
      // resolved path will cover aliased duplicates
      var resolvedPath = (0, _resolve2.default)(n.source.value, context) || n.source.value;

      if (imported.has(resolvedPath)) {
        imported.get(resolvedPath).add(n.source);
      } else {
        imported.set(resolvedPath, new _es6Set2.default([n.source]));
      }
    },

    'Program:exit': function ProgramExit() {
      for (var _iterator = imported.entries(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
        var _ref;

        if (_isArray) {
          if (_i >= _iterator.length) break;
          _ref = _iterator[_i++];
        } else {
          _i = _iterator.next();
          if (_i.done) break;
          _ref = _i.value;
        }

        var _ref2 = _ref;
        var _module = _ref2[0];
        var nodes = _ref2[1];

        if (nodes.size > 1) {
          for (var _iterator2 = nodes, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
            var _ref3;

            if (_isArray2) {
              if (_i2 >= _iterator2.length) break;
              _ref3 = _iterator2[_i2++];
            } else {
              _i2 = _iterator2.next();
              if (_i2.done) break;
              _ref3 = _i2.value;
            }

            var node = _ref3;

            context.report(node, '\'' + _module + '\' imported multiple times.');
          }
        }
      }
    }
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJ1bGVzL25vLWR1cGxpY2F0ZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7OztBQUNBOzs7O0FBRUE7Ozs7OztBQUVBLE9BQU8sT0FBUCxHQUFpQixVQUFVLE9BQVYsRUFBbUI7QUFDbEMsTUFBTSxXQUFXLHNCQUFYLENBRDRCO0FBRWxDLFNBQU87QUFDTCx5QkFBcUIsMkJBQVUsQ0FBVixFQUFhOztBQUVoQyxVQUFJLGVBQWUsdUJBQVEsRUFBRSxNQUFGLENBQVMsS0FBVCxFQUFnQixPQUF4QixLQUFvQyxFQUFFLE1BQUYsQ0FBUyxLQUFULENBRnZCOztBQUloQyxVQUFJLFNBQVMsR0FBVCxDQUFhLFlBQWIsQ0FBSixFQUFnQztBQUM5QixpQkFBUyxHQUFULENBQWEsWUFBYixFQUEyQixHQUEzQixDQUErQixFQUFFLE1BQUYsQ0FBL0IsQ0FEOEI7T0FBaEMsTUFFTztBQUNMLGlCQUFTLEdBQVQsQ0FBYSxZQUFiLEVBQTJCLHFCQUFRLENBQUMsRUFBRSxNQUFGLENBQVQsQ0FBM0IsRUFESztPQUZQO0tBSm1COztBQVdyQixvQkFBZ0IsdUJBQVk7QUFDMUIsMkJBQTRCLFNBQVMsT0FBVCxnSEFBNUIsSUFBZ0Q7Ozs7Ozs7Ozs7Ozs7WUFBdEMsbUJBQXNDO1lBQTlCLGlCQUE4Qjs7QUFDOUMsWUFBSSxNQUFNLElBQU4sR0FBYSxDQUFiLEVBQWdCO0FBQ2xCLGdDQUFpQiwwSEFBakIsSUFBd0I7Ozs7Ozs7Ozs7OztnQkFBZixhQUFlOztBQUN0QixvQkFBUSxNQUFSLENBQWUsSUFBZixTQUF5Qix1Q0FBekIsRUFEc0I7V0FBeEI7U0FERjtPQURGO0tBRGM7R0FabEIsQ0FGa0M7Q0FBbkIiLCJmaWxlIjoicnVsZXMvbm8tZHVwbGljYXRlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnZXM2LXN5bWJvbC9pbXBsZW1lbnQnXG5pbXBvcnQgTWFwIGZyb20gJ2VzNi1tYXAnXG5pbXBvcnQgU2V0IGZyb20gJ2VzNi1zZXQnXG5cbmltcG9ydCByZXNvbHZlIGZyb20gJy4uL2NvcmUvcmVzb2x2ZSdcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICBjb25zdCBpbXBvcnRlZCA9IG5ldyBNYXAoKVxuICByZXR1cm4ge1xuICAgICdJbXBvcnREZWNsYXJhdGlvbic6IGZ1bmN0aW9uIChuKSB7XG4gICAgICAvLyByZXNvbHZlZCBwYXRoIHdpbGwgY292ZXIgYWxpYXNlZCBkdXBsaWNhdGVzXG4gICAgICBsZXQgcmVzb2x2ZWRQYXRoID0gcmVzb2x2ZShuLnNvdXJjZS52YWx1ZSwgY29udGV4dCkgfHwgbi5zb3VyY2UudmFsdWVcblxuICAgICAgaWYgKGltcG9ydGVkLmhhcyhyZXNvbHZlZFBhdGgpKSB7XG4gICAgICAgIGltcG9ydGVkLmdldChyZXNvbHZlZFBhdGgpLmFkZChuLnNvdXJjZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGltcG9ydGVkLnNldChyZXNvbHZlZFBhdGgsIG5ldyBTZXQoW24uc291cmNlXSkpXG4gICAgICB9XG4gICAgfSxcblxuICAgICdQcm9ncmFtOmV4aXQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKGxldCBbbW9kdWxlLCBub2Rlc10gb2YgaW1wb3J0ZWQuZW50cmllcygpKSB7XG4gICAgICAgIGlmIChub2Rlcy5zaXplID4gMSkge1xuICAgICAgICAgIGZvciAobGV0IG5vZGUgb2Ygbm9kZXMpIHtcbiAgICAgICAgICAgIGNvbnRleHQucmVwb3J0KG5vZGUsIGAnJHttb2R1bGV9JyBpbXBvcnRlZCBtdWx0aXBsZSB0aW1lcy5gKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gIH1cbn1cbiJdfQ==